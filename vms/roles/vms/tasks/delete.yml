---

- name: remove virtual machines
  community.libvirt.virt:
    name: "{{ vmname }}-{{ item }}"
    state: destroyed
    command: destroy
    force: true
  when: count is defined
  loop: "{{ range(0, count)|list }}"

- name: remove virtual machine
  community.libvirt.virt:
    name: "{{ vmname }}"
    state: destroyed
    command: destroy
    force: true
  when: count is undefined